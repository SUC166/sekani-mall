{% extends 'base.html' %}
{% block title %}Order #{{ order.id }} - SEKANI Mall{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold">Order #{{ order.id }}</h3>
    <span class="badge fs-6
        {% if order.status == 'delivered' %}bg-success
        {% elif order.status == 'paid' %}bg-primary
        {% elif order.status == 'shipped' %}bg-info
        {% elif order.status == 'disputed' %}bg-warning
        {% else %}bg-secondary{% endif %}">
        {{ order.get_status_display }}
    </span>
</div>
<div class="row">
<div class="col-md-7">
    <div class="card p-3 mb-3">
        <h6 class="fw-bold">Items Ordered</h6>
        {% for item in order.items.all %}
        <div class="d-flex justify-content-between border-bottom py-2">
            <span>{{ item.product.name }} Ã— {{ item.quantity }}</span>
            <span>â‚¦{{ item.get_total|floatformat:2 }}</span>
        </div>
        {% endfor %}
        <div class="d-flex justify-content-between fw-bold mt-2">
            <span>Total</span><span class="text-success">â‚¦{{ order.total|floatformat:2 }}</span>
        </div>
    </div>
    <div class="card p-3 mb-3">
        <h6 class="fw-bold">Delivery Address</h6>
        <p class="mb-0">{{ order.delivery_address }}, {{ order.delivery_city }}, {{ order.delivery_state }}</p>
        <p class="mb-0 small text-muted">ðŸ“ž {{ order.delivery_phone }}</p>
    </div>

    {% if order.status == 'shipped' %}
    <div class="card p-3 border-success">
        <h6 class="fw-bold text-success">Confirm Delivery</h6>
        <p class="small">Enter the OTP sent to your phone to confirm you received your order.</p>
        <form method="POST" action="{% url 'confirm_delivery' order.id %}">
            {% csrf_token %}
            <div class="input-group">
                <input type="text" name="otp" class="form-control" placeholder="Enter OTP" maxlength="6">
                <button class="btn btn-success">Confirm</button>
            </div>
        </form>
    </div>
    {% endif %}

    {% if order.status == 'delivered' and not order.disputed %}
    <div class="mt-3">
        <a href="{% url 'raise_dispute' order.id %}" class="btn btn-outline-warning btn-sm">Raise a Dispute</a>
    </div>
    {% endif %}
</div>
<div class="col-md-5">
    <div class="card p-3">
        <h6 class="fw-bold">Order Timeline</h6>
        <ul class="list-unstyled">
            <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> Order Placed â€” {{ order.created_at|date:"d M Y" }}</li>
            {% if order.status != 'pending' %}<li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> Payment Confirmed</li>{% endif %}
            {% if order.status == 'shipped' or order.status == 'delivered' %}<li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> Shipped</li>{% endif %}
            {% if order.status == 'delivered' %}<li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> Delivered âœ…</li>{% endif %}
        </ul>
    </div>
</div>
</div>
{% endblock %}
